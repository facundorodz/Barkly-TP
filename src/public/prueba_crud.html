<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Perfil del Cuidador</title>
  <!-- Bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <style>
    body {
      background-color: #f5f7fb;
    }
    .perfil-header {
      background: linear-gradient(135deg, #4f46e5, #06b6d4);
      color: #fff;
      border-radius: 1rem;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }
    .avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid #fff;
    }
    .badge-rol {
      font-size: 0.8rem;
    }
    .card {
      border-radius: 1rem;
    }
  </style>
</head>
<body>
  <div class="container my-4">
    <!-- ENCABEZADO PERFIL -->
    <div class="perfil-header d-flex align-items-center justify-content-between">
      <div class="d-flex align-items-center">
        <img
          src="https://via.placeholder.com/80"
          alt="Foto cuidador"
          class="avatar me-3"
          id="avatar-cuidador"
        />
        <div>
          <h2 class="mb-0" id="nombre-superheroe-header">
            Nombre del Superh√©roe
          </h2>
          <span class="badge bg-warning text-dark badge-rol">Cuidador registrado</span>
          <p class="mb-0 mt-1" id="franquicia-header">Franquicia / Universo</p>
        </div>
      </div>
      <div class="text-end">
        <small class="d-block">Paquetes Ofrecidos: <span id="contador-paquetes">0</span></small>
      </div>
    </div>

    <div class="row g-4">
      <!-- COLUMNA PERFIL -->
      <div class="col-lg-4">
        <div class="card shadow-sm">
          <div class="card-header bg-primary text-white">
            <h5 class="mb-0">Datos de mi perfil</h5>
          </div>
          <div class="card-body">
            <form id="form-perfil">
              <div class="mb-3">
                <label for="nombre" class="form-label">Nombre de superh√©roe</label>
                <input type="text" class="form-control" id="nombre" placeholder="Ej: PerroMan" required/>
              </div>

              <div class="mb-3">
                <label for="franquicia" class="form-label">Franquicia / Universo</label>
                <input type="text" class="form-control" id="franquicia" placeholder="Marvel, DC, Original..." />
              </div>

              <div class="mb-3">
                <label for="experiencia" class="form-label">A√±os de experiencia</label>
                <input type="number" min="0" class="form-control" id="experiencia" placeholder="Ej: 3" />
              </div>

              <div class="mb-3">
                <label for="poderes" class="form-label">Poderes / Habilidades</label>
                <textarea class="form-control" id="poderes" rows="2" placeholder="Ej: paseos largos, juegos, entrenamiento b√°sico..." ></textarea>
              </div>

              <div class="d-flex justify-content-between">
                <button type="submit" class="btn btn-primary btn-sm">
                  Guardar cambios
                </button>
                <button type="button" class="btn btn-outline-secondary btn-sm" id="btn-cancelar-perfil">
                  Deshacer cambios
                </button>
              </div>
            </form>

            <hr/>

            <div class="d-flex justify-content-between">
              <button type="button" class="btn btn-outline-danger btn-sm" id="btn-eliminar-cuenta">
                Eliminar cuenta
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- COLUMNA PAQUETES -->
      <div class="col-lg-8">
        <!-- LISTA DE PAQUETES -->
        <div class="card shadow-sm mb-4">
          <div class="card-header bg-success text-white d-flex justify-content-between">
            <h5 class="mb-0">Mis paquetes</h5>
            <span class="small">Agregar, editar o eliminar servicios</span>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table align-middle" id="tabla-paquetes">
                <thead>
                  <tr>
                    <th>Nombre</th>
                    <th>Descripci√≥n</th>
                    <th>Precio</th>
                    <th class="text-center">Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- Ejemplo de fila (luego se reemplaza din√°micamente con JS) -->
                  <!--
                  <tr data-id="1">
                    <td>Paquete Est√°ndar</td>
                    <td>Paseo b√°sico de 30 minutos.</td>
                    <td>$1500</td>
                    <td class="text-center">
                      <button class="btn btn-sm btn-outline-primary btn-editar">Editar</button>
                      <button class="btn btn-sm btn-outline-danger btn-eliminar">Eliminar</button>
                    </td>
                  </tr>
                  -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- FORMULARIO NUEVO PAQUETE -->
        <div class="card shadow-sm">
          <div class="card-header bg-light">
            <h5 class="mb-0">Agregar / editar paquete</h5>
          </div>
          <div class="card-body">
            <form id="form-paquete">
              <!-- Campo oculto para ID cuando se edita -->
              <input type="hidden" id="paquete_id" />

              <div class="row g-3">
                <div class="col-md-4">
                  <label for="nombre_paquete" class="form-label">Nombre del paquete</label>
                  <input type="text" class="form-control" id="nombre_paquete" placeholder="Ej: Est√°ndar / Premium / Deluxe" required />
                </div>

                <div class="col-md-4">
                  <label for="precio_paquete" class="form-label">Precio</label>
                  <input type="number" min="0" class="form-control" id="precio_paquete" placeholder="Ej: 3000" required />
                </div>

                <div class="col-12">
                  <label for="descripcion_paquete" class="form-label">Descripci√≥n</label>
                  <textarea class="form-control" id="descripcion_paquete" rows="2" placeholder="Describe qu√© incluye este paquete." required ></textarea>
                </div>
              </div>

              <div class="mt-3 d-flex justify-content-between">
                <div>
                  <button type="submit" class="btn btn-success btn-sm" id="btn-guardar-paquete">
                    Guardar paquete
                  </button>
                  <button type="button" class="btn btn-outline-secondary btn-sm" id="btn-limpiar-paquete">
                    Limpiar formulario
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- Bootstrap JS (opcional, para componentes como modals si luego us√°s) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- ================== SCRIPT FINAL CORREGIDO ================== -->
  <script>


    const API_URL = "http://localhost:3000/cuidadores";
    const CUIDADOR_ID = 2;

    // ===============================
    // CARGAR DATOS DEL CUIDADOR
    // ===============================
    async function cargarCuidador() {
      try {
        const res = await fetch(`${API_URL}/${CUIDADOR_ID}`);
        const data = await res.json();

        // Encabezado
        document.getElementById("nombre-superheroe-header").textContent = data.nombre;
        document.getElementById("franquicia-header").textContent = data.franquicia;
        document.getElementById("contador-paquetes").textContent = data.paquetes_ofrecidos ?? 0;

        // Formulario
        document.getElementById("nombre").value = data.nombre;
        document.getElementById("franquicia").value = data.franquicia;
        document.getElementById("experiencia").value = data.experiencia;
        document.getElementById("poderes").value = data.poderes;

      } catch (err) {
        console.error("Error cargando cuidador:", err);
      }
    }

    // ===============================
    // GUARDAR CAMBIOS
    // ===============================
    document.getElementById("form-perfil").addEventListener("submit", async (e) => {
      e.preventDefault();

      const cambios = {
        nombre: document.getElementById("nombre").value,
        franquicia: document.getElementById("franquicia").value,
        experiencia: Number(document.getElementById("experiencia").value),
        poderes: document.getElementById("poderes").value,
      };

      await fetch(`${API_URL}/${CUIDADOR_ID}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(cambios),
      });

      alert("Datos actualizados");
      cargarCuidador();
    });

    // ===============================
    // ELIMINAR CUENTA
    // ===============================
    document.getElementById("btn-eliminar-cuenta").addEventListener("click", async () => {
      if (!confirm("¬øSeguro que quer√©s eliminar este cuidador?")) return;

      await fetch(`${API_URL}/${CUIDADOR_ID}`, {
        method: "DELETE"
      });

      alert("Cuenta eliminada");
    });


  // ===============================
  // CARGAR LISTA DE PAQUETES
  // ===============================
  async function cargarPaquetes() {
    try {
      const res = await fetch(`http://localhost:3000/cuidadores/${CUIDADOR_ID}/paquetes`);
      const paquetes = await res.json();

      const tbody = document.querySelector("#tabla-paquetes tbody");
      tbody.innerHTML = "";

      paquetes.forEach(p => {
        tbody.innerHTML += `
          <tr>
            <td>${p.nombre_paquete}</td>
            <td>${p.descripcion}</td>
            <td>$${p.precio}</td>
            <td class="text-center">
              <button class="btn btn-sm btn-outline-primary" onclick='cargarFormularioPaquete(${JSON.stringify(p)})'>Editar</button>
              <button class="btn btn-sm btn-outline-danger" onclick="eliminarPaquete(${p.id})">Eliminar</button>
            </td>
          </tr>
        `;
      });

      // üî• EL CONTADOR SIEMPRE SE ACTUALIZA DESDE LA BDD
      document.getElementById("contador-paquetes").textContent = paquetes.length;
    } catch (error) {
      console.error("Error cargando paquetes:", error);
    }
  }

  function cargarFormularioPaquete(p) {
    document.getElementById("paquete_id").value = p.id;
    document.getElementById("nombre_paquete").value = p.nombre_paquete;
    document.getElementById("descripcion_paquete").value = p.descripcion;
    document.getElementById("precio_paquete").value = p.precio;
  }


  // ===============================
  // Editar paquete
  // ===============================
  async function editarPaquete(id) {
    const nombre = prompt("Nuevo nombre:");
    const desc = prompt("Nueva descripci√≥n:");
    const precio = prompt("Nuevo precio:");

    await fetch(`${API_URL}/paquetes/${id}`, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        nombre_paquete: nombre,
        descripcion: desc,
        precio: precio
      })
    });

    cargarPaquetes();
  }

  async function eliminarPaquete(id) {
    if (!confirm("Eliminar paquete?")) return;

    await fetch(`${API_URL}/paquetes/${id}`, { method: "DELETE" });

    cargarPaquetes();
  }

    // ===============================
    // AL CARGAR LA P√ÅGINA
    // ===============================
    cargarCuidador();
    cargarPaquetes();

    
  </script>

</body>
</html>
